#############
# Automatically generated by generator.py in splunk/security-content
# On Date: {{ time }} UTC
# Author: Splunk Security Research
# Contact: research@splunk.com
#############

### STORIES ###

{% for story in stories %}
[{{ story.name }}]
category =  {{ story.tags.category[0] }}
creation_date = {{ story.date }}
modification_date = {{ story.date }}
id = {{ story.id }}
version = {{ story.version }}
reference = {{ story.references | tojson }}
detection_searches = {{ story.detections | tojson }}
{% if story.mappings is defined %}
mappings = {{ story.mappings | tojson }}
{% endif %}
{% if story.response_tasks is defined %}
investigative_searches = {{ story.response_tasks | tojson }}
{% else %}
investigative_searches = []
{% endif %}
{% if story.baselines is defined %}
support_searches = {{ story.baselines | tojson }}
{% else %}
support_searches = []
{% endif %}
{% if story.data_models is defined %}
data_models = {{ story.data_models | tojson }}
{% else %}
data_models = []
{% endif %}
providing_technologies = none
description = {{ story.description }}
{% if story.narrative is defined %}
narrative = {{ story.narrative }}
{% endif %}

cron_schedule = {{ story.deployment.scheduling.cron_schedule }}
dispatch.earliest_time = {{ story.deployment.scheduling.earliest_time }}
dispatch.latest_time = {{ story.deployment.scheduling.latest_time }}
action.correlationsearch.enabled = 1
action.correlationsearch.label = {{ story.type | default('ESCU') }} - {{ story.name }} - Rule
action.correlationsearch.annotations = {{ story.savedsearch_annotations | tojson }}
{% if story.deployment.scheduling.schedule_window is defined %}
schedule_window = {{ story.deployment.scheduling.schedule_window }}
{% endif %}
{% if story.deployment.alert_action is defined %}
{% if story.deployment.alert_action.notable is defined %}
action.notable = 1
{% if story.nes_fields is defined %}
action.notable.param.nes_fields = {{ detection.nes_fields }}
{% endif %}
action.notable.param.rule_description = {{ story.deployment.alert_action.notable.rule_description | custom_jinja2_enrichment_filter(story) }}
action.notable.param.rule_title = {{ story.deployment.alert_action.notable.rule_title | custom_jinja2_enrichment_filter(story) }}
action.notable.param.security_domain = {{ detection.tags.security_domain }}
action.notable.param.severity = high
{% endif %}
{% if story.deployment.alert_action.email is defined %}
action.email.subject.alert = {{ story.deployment.alert_action.email.subject | custom_jinja2_enrichment_filter(story) }}
action.email.to = {{ story.deployment.alert_action.email.to }}
action.email.message.alert = {{ story.deployment.alert_action.email.message | custom_jinja2_enrichment_filter(story) }}
action.email.useNSSubject = 1
{% endif %}
{% endif %}
alert.digest_mode = 1
disabled = true
enableSched = 1
counttype = number of events
relation = greater than
quantity = 0
realtime_schedule = 0
is_visible = false
search = {{ detection.search }}


{% endfor %}
#### END STORIES ####
